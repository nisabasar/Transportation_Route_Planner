<!-- templates/results.html -->
{% extends "base.html" %} {% block title %}Rota SonuÃ§larÄ±{% endblock %} {% block
content %}
<div class="fade-in-up">
  <h1 class="mb-4">Rota SonuÃ§larÄ±</h1>
  <p>
    GirdiÄŸiniz bilgilere gÃ¶re hesaplanan alternatif rota seÃ§enekleri aÅŸaÄŸÄ±dadÄ±r.
  </p>
  <ul class="nav nav-tabs" id="routeTab" role="tablist">
    {% for route_type, route in routes.items() %}
    <li class="nav-item" role="presentation">
      <button
        class="nav-link {% if loop.first %}active{% endif %}"
        id="{{ route_type }}-tab"
        data-bs-toggle="tab"
        data-bs-target="#{{ route_type }}"
        type="button"
        role="tab"
        aria-controls="{{ route_type }}"
        aria-selected="{% if loop.first %}true{% else %}false{% endif %}"
      >
        {{ route_type | replace('_', ' ') | capitalize }}
      </button>
    </li>
    {% endfor %}
  </ul>
  <div class="tab-content mt-3" id="routeTabContent">
    {% for route_type, route in routes.items() %}
    <div
      class="tab-pane fade {% if loop.first %}show active{% endif %}"
      id="{{ route_type }}"
      role="tabpanel"
      aria-labelledby="{{ route_type }}-tab"
    >
      {% if route %}
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">
            {{ route_type | replace('_', ' ') | capitalize }} Rota DetaylarÄ±
          </h5>
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>AÅŸama</th>
                <th>BaÅŸlangÄ±Ã§</th>
                <th>VarÄ±ÅŸ</th>
                <th>UlaÅŸÄ±m</th>
                <th>SÃ¼re (dk)</th>
                <th>Mesafe (km)</th>
                <th>Ãœcret (TL)</th>
              </tr>
            </thead>
            <tbody>
              {% for step in route.steps %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ step.from }}</td>
                <td>{{ step.to }}</td>
                <td>
                  {% if step.mode == 'taksi' %}ğŸš– Taksi {% elif step.mode ==
                  'bus' %}ğŸšŒ OtobÃ¼s {% elif step.mode == 'tram' %}ğŸš‹ Tramvay {%
                  elif step.mode == 'yÃ¼rÃ¼me' %}ğŸš¶ YÃ¼rÃ¼me {% elif step.mode ==
                  'transfer' %}ğŸ”„ Transfer {% else %}{{ step.mode }} {% endif %}
                </td>
                <td>{{ step.time }}</td>
                <td>{{ step.distance }}</td>
                <td>{{ step.cost }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <p><strong>Toplam SÃ¼re:</strong> {{ route.total_time }} dk</p>
          <p><strong>Toplam Mesafe:</strong> {{ route.total_distance }} km</p>
          <p><strong>Toplam Ãœcret:</strong> {{ route.total_cost }} TL</p>
          <p>
            <strong>Ä°ndirimli Ãœcret:</strong> {{ route.discounted_cost }} TL
          </p>
          {% if route.arrival_time %}
          <p><strong>VarÄ±ÅŸ Saati:</strong> {{ route.arrival_time }}</p>
          {% endif %} {% set pay_res = payment_results[route_type] %} {% if
          pay_res %} {% if pay_res.success %}
          <div class="alert alert-success" role="alert">
            {{ pay_res.message }}
          </div>
          {% else %}
          <div class="alert alert-danger" role="alert">
            {{ pay_res.message }}
          </div>
          {% endif %} {% endif %}
          <div id="map_{{ route_type }}" style="height: 300px"></div>
        </div>
      </div>
      {% else %}
      <div class="alert alert-warning" role="alert">
        Bu rota iÃ§in uygun baÄŸlantÄ± bulunamadÄ±.
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  <div class="text-center">
    <a href="{{ url_for('route_page') }}" class="btn btn-success btn-lg"
      >Yeni Rota Hesapla</a
    >
  </div>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script src="{{ url_for('static', filename='js/map_draw.js') }}"></script>
<script>
  {% for route_type, route in routes.items() %}
    {% if route and route.latlon_segments %}
      drawRouteOnMap("map_{{ route_type }}", {{ route.latlon_segments|tojson }});
    {% endif %}
  {% endfor %}
</script>
{% endblock %}
